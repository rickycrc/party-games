var Bingo=Bingo||{},aAudio;Bingo.startLoading=function(){$("body").addClass("loading")};Bingo.stopLoading=function(){$("body").removeClass("loading")};Bingo.isLoading=function(){return $("body").hasClass("loading")};Bingo.ajaxCustomError=function(n){return n?n.Success===!1?(n.Message?alert(n.Message.replace(new RegExp("<br />","g"),"\n")):n.Messages&&alert(n.Messages.join("\n")),n.Redirect&&(window.location.href=n.Redirect),!1):!0:!1};Bingo.isValidResponse=function(n){return n?n.Success===!1?(Bingo.ajaxCustomError(n),!1):!0:!0};Bingo.dashboard=Bingo.dashboard||{};Bingo.dashboard.init=function(){aAudio=new Audio("/Asserts/mp3/Bingo-Draw2.mp3");setInterval(function(){$("div.name[data-active=true]").toggleClass("active")},500);$("body").addClass("dashboard");$.ajax({url:$.api("liveData"),type:"POST",data:{key:"dashboard"}}).done(function(n){if(n.Success&&($(".cols .no").removeClass("active"),$.each(n.Numbers,function(n,t){$(".cols .no[data-val='"+t+"']").addClass("active")}),Bingo.dashboard.getPlayerlist(),n.Numbers.length===0)){var t=setInterval(Bingo.dashboard.getPlayerlist,1e4);$(".player-list").data("timer",t)}});$(".btn-roll").on("click",function(n){n.preventDefault();Bingo.dashboard.roll()})};Bingo.dashboard.getPlayerlist=function(){var n=$(".player-list"),t=$(".champion-list");$("tr.data",n).remove();$("div.name",t).remove();$.ajax({url:$.api("playerList"),type:"POST"}).done(function(i){if(i.Success){$.each(i.RankingList,function(t,i){var r=$("<tr class='data' />"),u,f;r.append("<td>"+i.Ranking+"<\/td>");r.append("<td>"+i.CardNo+"<\/td>");u=$("<span class='name'>"+i.Name+"<\/span>");u.on("click",function(n){n.preventDefault();var t=$.api("play");window.open(t+"?card="+i.Key,"carddetails","location=yes,height=750,width=520,scrollbars=no,status=yes")});f=$("<td />");f.append(u);r.append(f);i.BingoMark1<=1?(r.append("<td> - <\/td>"),r.append("<td> - <\/td>")):(r.append("<td>"+i.BingoMark2+"<\/td>"),r.append("<td><span class='circle-no'>"+i.BingoMark1+"<\/span><\/td>"));n.append(r)});var r=!1;$.each(i.ChampionList,function(n,i){var u=$("<div class='name' />"),f;i.Active&&(r=!0,u.attr("data-active",!0));f="<span class='ranking'>第 "+i.Ranking+" 名<\/span><span class='circle-no'>"+i.BingoMark2+"<\/span>";f+="<br />#"+i.CardNo+" "+i.Name;u.html(f);u.on("click",function(n){n.preventDefault();var t=$.api("play");window.open(t+"?card="+i.Key,"carddetails","location=yes,height=750,width=520,scrollbars=yes,status=yes")});t.append(u)});$(".champion-count").html(i.ChampionList.length);r&&Bingo.dashboard.newWinner()}})};Bingo.dashboard.roll=function(){var n=$(".btn-roll"),t;n.hasClass("rolling")||(aAudio.play(),n.addClass("rolling"),t=setInterval(function(){$(".bingo-digit.d1").html(Math.floor(Math.random()*10));$(".bingo-digit.d2").html(Math.floor(Math.random()*10))},100),n.data("timer",t),$(".player-list").data("timer")&&(clearInterval($(".player-list").data("timer")),$(".player-list").data("timer",null)),$.ajax({url:$.api("bingoRoll"),type:"POST"}).done(function(t){clearInterval(n.data("timer"));t.D1&&t.D2&&($(".cols .no[data-val='"+t.NewNumber+"']").addClass("active"),$(".bingo-digit.d1").html(t.D1),$(".bingo-digit.d2").html(t.D2));Bingo.dashboard.getPlayerlist();n.removeClass("rolling")}))};Bingo.dashboard.newWinner=function(){$("body").addClass("new-winner");$("body").append("<div class='new-winner_bg'><img src='/Asserts/images/Bingo_Win_3a.png' /><\/div>");$(".new-winner_bg img").addClass("slideInDown animated");setTimeout(function(){$(".new-winner_bg img").attr("class","");$(".new-winner_bg img").addClass("animated swing infinite");setTimeout(function(){$(".new-winner_bg img").attr("class","");$(".new-winner_bg img").addClass("animated zoomOutUp");setTimeout(function(){$("body").removeClass("new-winner");$(".new-winner_bg").remove()},1e3)},3e3)},1e3)};Bingo.play=Bingo.play||{};Bingo.play.getBingoKey=function(){return request.card||$.cookie("bingokey")};Bingo.play.init=function(){$("body").addClass("play");$("#btnSubmitName").on("click",function(n){n.preventDefault();Bingo.play.addPlayer()});$("#btnChangeName").on("click",function(n){n.preventDefault();var t=$.trim($("#txtChangeName").val());Bingo.play.changeName(t)});if(request.newkey==="true")$(".enter-your-name").show(),$("#txtName").val(decodeURIComponent(request.name)),$("#txtPassword").val(request.pwd),$("#btnSubmitName").trigger("click");else{var n=Bingo.play.getBingoKey();n?Bingo.play.getPlayer(n):$(".enter-your-name").show()}$(".bingo-loading").hide()};Bingo.play.createBingoBox=function(n,t){var i,r;$(".bingo-gamekey").html(t.Key);$(".bingo-no-box .card-name").html("<span class='name'>"+t.CardName+"<\/span>");i=$("<a href='#' class='edit-name'><i class='fas fa-pencil-alt fa-xs'><\/i><\/a>");i.on("click",function(n){n.preventDefault();$(".bingo-no-box").hide();$(".bingo-change-name").show();$("#txtChangeName").val(t.Name);$("#txtChangeName").get(0).focus()});$(".bingo-no-box .card-name").append(i);r=t.CardNumbers;$(".enter-your-name").hide();$(".bingo-no-box").show();$(".bingo-no-box .inner").html("");$.each(r,function(t,i){var u=$("<div class='bingoBox'><div class='bingoItem'><\/div><\/div>"),r=$("<div class='bingoNumber' />");i===0?r.html("<img src='/Asserts/images/Feng_Logo_100.jpg' style='width: 70%;'><\/img>"):r.html(i).attr("data-val",i);n.RolledNumbers.indexOf(i)>-1&&r.addClass("active");$(".bingoItem",u).append(r);$(".bingo-no-box .inner").append(u)});Bingo.play.startReceiveLiveData()};Bingo.play.addPlayer=function(){return Bingo.isLoading()?!1:($.ajax({url:$.api("addPlayer"),type:"POST",data:{name:$("#txtName").val(),password:$("#txtPassword").val()},beforeSend:function(){Bingo.startLoading()}}).done(function(n){Bingo.isValidResponse(n)&&($.cookie("bingokey",n.Player.Key,{expires:7}),Bingo.play.createBingoBox(n.Game,n.Player))}).always(function(){Bingo.stopLoading()}),!1)};Bingo.play.changeName=function(n){if(Bingo.isLoading())return!1;$.ajax({url:$.api("changeName"),data:{name:n,key:Bingo.play.getBingoKey},type:"POST"}).done(function(n){n.Player&&$(".bingo-no-box .card-name .name").html(n.Player.CardName)}).always(function(){Bingo.stopLoading();$(".bingo-no-box").show();$(".bingo-change-name").hide()})};Bingo.play.getPlayer=function(n){if(Bingo.isLoading())return!1;$.ajax({url:$.api("getPlayer"),type:"POST",data:{key:n},beforeSend:function(){Bingo.startLoading()}}).done(function(n){if(!n.Success){$.removeCookie("bingokey");window.location.href="/bingo/play";return}Bingo.play.createBingoBox(n.Game,n.Player)}).always(function(){Bingo.stopLoading()})};Bingo.play.startReceiveLiveData=function(){if($(".bingo-no-box").is(":visible")){$(".bingo-no-box").data("interval")&&clearInterval($(".bingo-no-box").data("interval"));var n=setInterval(function(){var n=Bingo.play.getBingoKey();$.ajax({url:$.api("liveData"),type:"POST",data:{key:n}}).done(function(n){if(!n.Success){$.removeCookie("bingokey");window.location.href="/bingo/play?error=invalid_player";return}$(".bingoNumber").removeClass("active");$.each(n.Numbers,function(n,t){$(".bingoNumber[data-val='"+t+"']").addClass("active")})}).always(function(){})},5e3);$(".bingo-no-box").data("interval",n)}};